sap.ui.define([
    "sap/ui/core/mvc/Controller",
    "sap/ui/model/json/JSONModel",
    "sap/m/MessageBox",
    "sap/ui/model/Sorter"    
], function(Controller, JSONModel, MessageBox, Sorter) {
    "use strict";

    return Controller.extend("com.ui5.train.orders.controller.OrdersMain", {
        onInit: function() {                        
            // Load mock data from model folder
            //var oModel = new sap.ui.model.json.JSONModel();
            //oModel.loadData("localService/mainService/data/Orders.json");  
            var oModel = new sap.ui.model.json.JSONModel("webapp/model/Orders.json");
            this.getView().setModel(oModel, "orderdetails");              
            // path relative to project root 
            //this.setModel(oModel, "orderdetails");              
            //let oRouter = this.getOwnerComponent().getRouter();
            //oRouter.getRoute("RouteOrdersMain").attachPatternMatched(this._onRouteMatched, this);          
        },

        onPressOrder: function(oEvent) {
            let sOrderID = oEvent.getSource().getBindingContext().getProperty("OrderID");
            this.getOwnerComponent().getRouter().navTo("RouteOrderDetails", {
                OrderID: sOrderID
            });
        },

        onDelete: function() {            
            let oBundle = this.getView().getModel("i18n").getResourceBundle();
            let sMsgHeader = oBundle.getText("message.onDelete")
            let oTable = this.byId("ordersTable");
            let aSelectedItems = oTable.getSelectedItems();
            let oModel = this.getOwnerComponent().getModel();
            let iPending = aSelectedItems.length;
                                            
            if (aSelectedItems.length > 0) {
                let sMessage = oBundle.getText("message.onDelete.Confirmation");                                 
                aSelectedItems.forEach(function(item) {                    
                    let sPath = item.getBindingContext().getPath();
                    MessageBox.show(sMessage, {
                        title: sMsgHeader,
                        styleClass: "sapUiSizeCompact",
                        actions: [sap.m.MessageBox.Action.OK],
                        onClose: function(oAction) {
                            //Code to delete data here     
                            oModel.remove(sPath);                                          
                        }
                    });                                        
            });
            } else {
                let sMessage = oBundle.getText("message.onDelete.SelectItem");
                //Raise message Please select an item from the table
                MessageBox.error(sMessage,{
                        title: sMsgHeader,
                        styleClass: "sapUiSizeCompact",
                        actions: [sap.m.MessageBox.Action.OK],
                        onClose: function(oAction) {
                            //no action after close
                        }
                });
            }

        }
    });
});